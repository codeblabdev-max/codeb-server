# CodeB Server ë¬¸ì œì  ë¶„ì„ ë¦¬í¬íŠ¸
## ìž‘ì„±ì¼: 2025-08-20

---

## ðŸ”´ í˜„ìž¬ ìƒí™©

### celly-creative í”„ë¡œì íŠ¸ ìƒíƒœ
- **ë„ë©”ì¸**: https://celly-creative.codeb.one-q.xyz
- **í• ë‹¹ í¬íŠ¸**: 4004 (ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨)
- **Pod**: celly-creative-pod (Running)
- **ë¬¸ì œ**: Next.js ì•±ì´ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

### í˜„ìž¬ ë°œìƒ ì¤‘ì¸ ì—ëŸ¬ë“¤
1. **403 Forbidden**: ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ê°€ curl ìš”ì²­ì„ ì°¨ë‹¨
2. **502 Bad Gateway**: ì•±ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•„ Caddyê°€ í”„ë¡ì‹œ ì‹¤íŒ¨
3. **CORS ì°¨ë‹¨**: API í˜¸ì¶œì´ ëª¨ë‘ ì°¨ë‹¨ë¨
4. **ë¡œê·¸ì¸ ì‹¤íŒ¨**: ë°ì´í„°ë² ì´ìŠ¤ì— ì‚¬ìš©ìžê°€ ì—†ìŒ
5. **ë¹Œë“œ ëˆ„ë½**: Production ë¹Œë“œê°€ ì—†ì–´ì„œ ì•± ì‹œìž‘ ì‹¤íŒ¨

---

## ðŸ“Š ë¬¸ì œì  ë¶„ì„

### 1. ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸° ë¬¸ì œ
```
ë¬¸ì œ: ì»¨í…Œì´ë„ˆê°€ npm start ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¢…ë£Œë¨
ì›ì¸: CMDê°€ "npm start"ë¡œ ì„¤ì •ë˜ì–´ ìžˆì–´ ì‹¤íŒ¨ ì‹œ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
ì˜í–¥: ë””ë²„ê¹… ë¶ˆê°€ëŠ¥, ì§€ì†ì ì¸ ìž¬ì‹œìž‘ ë£¨í”„
```

### 2. ë³´ì•ˆ ì„¤ì • ê³¼ë„í•¨
```javascript
// src/middleware.security.improved.ts
if (isBot && !isGoodBot) {
    return { 
        allowed: false, 
        reason: 'Suspicious bot detected',
        action: 'block'
    }
}
```
- curl, wget ë“± ëª¨ë‹ˆí„°ë§ ë„êµ¬ê¹Œì§€ ì°¨ë‹¨
- ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë„ ì—„ê²©í•œ ë³´ì•ˆ ì ìš©

### 3. CORS ì„¤ì • ë¬¸ì œ
```
Blocked CORS request from origin: https://celly-creative.codeb.one-q.xyz
```
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë„ë©”ì¸ì´ í—ˆìš© ëª©ë¡ì— ì—†ìŒ
- í™˜ê²½ë³€ìˆ˜ë¡œ CORS ì„¤ì •ì„ ì˜¤ë²„ë¼ì´ë“œí•  ìˆ˜ ì—†ìŒ

### 4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ë°ì´í„°
```
[INFO] { email: 'admin@linkpick.co.kr' } Login failed - user not found
```
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì—°ê²°ë˜ì—ˆì§€ë§Œ ì‚¬ìš©ìž ë°ì´í„° ì—†ìŒ
- **ê·¼ë³¸ ì›ì¸**: ì‹¤ì œ ë°ì´í„° ë°±ì—…/ë³µì› í”„ë¡œì„¸ìŠ¤ ì—†ìŒ
- í˜„ìž¬ëŠ” seed ìŠ¤í¬ë¦½íŠ¸ì—ë§Œ ì˜ì¡´ (ìƒ˜í”Œ ë°ì´í„°ë§Œ ìƒì„±)
- **í•´ê²°ì±…**: SQL ë°±ì—… íŒŒì¼ì„ í†µí•œ ì‹¤ì œ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”

### 5. ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ ëˆ„ë½
```
Error: Could not find a production build in the '.next' directory
```
- ë°°í¬ ì‹œ `npm run build` ë‹¨ê³„ ëˆ„ë½
- ê°œë°œ ëª¨ë“œì™€ í”„ë¡œë•ì…˜ ëª¨ë“œ í˜¼ìž¬

---

## ðŸ› ï¸ ê¸°ìˆ ì  ë¬¸ì œì 

### API ì„œë²„ (codeb-api-server.js)
1. **ë¶ˆì™„ì „í•œ ë°°í¬ í”„ë¡œì„¸ìŠ¤**
   - ë¹Œë“œ ë‹¨ê³„ê°€ ë°°í¬ APIì— í¬í•¨ë˜ì§€ ì•ŠìŒ
   - í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ ë¶ˆì™„ì „í•¨
   - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜/ì‹œë“œ ì‹¤í–‰ ë¶ˆì•ˆì •

2. **ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±**
   - ì»¨í…Œì´ë„ˆ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ
   - ë¶€ë¶„ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ì—†ìŒ

3. **exec ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€í–ˆì§€ë§Œ ë¯¸ì‚¬ìš©**
   - CLIì—ì„œ exec ëª…ë ¹ ë¯¸êµ¬í˜„
   - ë””ë²„ê¹…ì— í•„ìš”í•œ ê¸°ëŠ¥ ëˆ„ë½

### CLI ë„êµ¬ (codeb-cli-v2.sh)
1. **í•„ìˆ˜ ëª…ë ¹ ëˆ„ë½**
   - exec: ì»¨í…Œì´ë„ˆ ë‚´ ëª…ë ¹ ì‹¤í–‰
   - env: í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
   - db: ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

2. **ìƒíƒœ í™•ì¸ ë¶ˆì¶©ë¶„**
   - ì•± ì‹¤í–‰ ìƒíƒœë§Œ í™•ì¸, ì‹¤ì œ ì„œë¹„ìŠ¤ ê°€ìš©ì„± ë¯¸í™•ì¸

### ì¸í”„ë¼ ì„¤ì •
1. **í¬íŠ¸ ê´€ë¦¬**
   - ì™¸ë¶€ í¬íŠ¸ ë°©í™”ë²½ ì„¤ì • ìˆ˜ë™ í•„ìš”
   - í¬íŠ¸ ì¶©ëŒ ê°ì§€ ì—†ìŒ

2. **ë¡œê·¸ ê´€ë¦¬**
   - ë¡œê·¸ ë¡œí…Œì´ì…˜ ì—†ìŒ
   - ì—ëŸ¬ ë¡œê·¸ì™€ ì•¡ì„¸ìŠ¤ ë¡œê·¸ ë¯¸ë¶„ë¦¬

---

## ðŸ“ˆ ê°œì„  í•„ìš”ì‚¬í•­

### ì¦‰ì‹œ ê°œì„  (Critical)
1. **ì»¨í…Œì´ë„ˆ ì•ˆì •ì„±**
   ```dockerfile
   # ê°œì„ ì•ˆ: ì˜êµ¬ ì‹¤í–‰ ì»¨í…Œì´ë„ˆ
   CMD ["sh", "-c", "npm run build && npm start || tail -f /dev/null"]
   ```

2. **í™˜ê²½ë³„ ë³´ì•ˆ ì„¤ì •**
   ```javascript
   // ê°œë°œ/ìŠ¤í…Œì´ì§•ì€ ì™„í™”ëœ ë³´ì•ˆ
   if (process.env.ENVIRONMENT === 'production') {
       // ì—„ê²©í•œ ë³´ì•ˆ
   } else {
       // ì™„í™”ëœ ë³´ì•ˆ
   }
   ```

3. **CORS ë™ì  ì„¤ì •**
   ```javascript
   const allowedOrigins = process.env.ALLOWED_ORIGINS?.split(',') || []
   ```

### ë‹¨ê¸° ê°œì„  (1ì£¼ì¼)
1. **ë°°í¬ í”„ë¡œì„¸ìŠ¤ ê°œì„ **
   - ë¹Œë“œ â†’ í…ŒìŠ¤íŠ¸ â†’ ë°°í¬ íŒŒì´í”„ë¼ì¸
   - í—¬ìŠ¤ì²´í¬ ì¶”ê°€
   - ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜

2. **CLI ê¸°ëŠ¥ í™•ìž¥**
   - exec ëª…ë ¹ ì¶”ê°€
   - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
   - ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

3. **ëª¨ë‹ˆí„°ë§ ì¶”ê°€**
   - ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
   - ë©”íŠ¸ë¦­ ìˆ˜ì§‘
   - ì•Œë¦¼ ì‹œìŠ¤í…œ

### ìž¥ê¸° ê°œì„  (1ê°œì›”)
1. **í…œí”Œë¦¿ ì‹œìŠ¤í…œ**
   - Next.js ì „ìš© í…œí”Œë¦¿
   - í™˜ê²½ë³„ ì„¤ì • í”„ë¦¬ì…‹
   - ìžë™ ìµœì í™”

2. **CI/CD í†µí•©**
   - GitHub Actions ì—°ë™
   - ìžë™ í…ŒìŠ¤íŠ¸
   - ìŠ¤í…Œì´ì§• í™˜ê²½

3. **ìŠ¤ì¼€ì¼ë§**
   - ë¡œë“œ ë°¸ëŸ°ì‹±
   - ì˜¤í†  ìŠ¤ì¼€ì¼ë§
   - ìºì‹± ë ˆì´ì–´

---

## ðŸŽ¯ ì¦‰ì‹œ ì‹¤í–‰ ê³„íš

### Step 1: ì»¨í…Œì´ë„ˆ ìˆ˜ì •
```bash
# ì˜êµ¬ ì‹¤í–‰ ì»¨í…Œì´ë„ˆë¡œ ìž¬ìƒì„±
podman run -d --name celly-creative-app \
  --pod celly-creative-pod \
  -v celly-creative-data:/app \
  node:20-alpine \
  tail -f /dev/null
```

### Step 2: ìˆ˜ë™ ë¹Œë“œ ë° ì‹¤í–‰
```bash
# 1. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cat > .env << EOF
DATABASE_URL=postgresql://user:password@localhost:5432/celly-creative
NEXT_PUBLIC_API_URL=https://celly-creative.codeb.one-q.xyz
DISABLE_BOT_PROTECTION=true
ALLOWED_ORIGINS=https://celly-creative.codeb.one-q.xyz
NODE_ENV=production
EOF

# 2. ë¹Œë“œ
npm run build

# 3. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
# ì˜µì…˜ A: ì‹¤ì œ ë°ì´í„° ë³µì› (ê¶Œìž¥)
psql -U user -d celly-creative < /path/to/backup.sql

# ì˜µì…˜ B: í…ŒìŠ¤íŠ¸ìš© ìŠ¤í‚¤ë§ˆ ë° ìƒ˜í”Œ ë°ì´í„°
npx prisma db push
npx tsx prisma/seed-sample-data.ts

# 4. ì‹¤í–‰
npm start
```

### Step 3: API ì„œë²„ ê°œì„ 
- ë°°í¬ APIì— ë¹Œë“œ ë‹¨ê³„ ì¶”ê°€
- í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- ì—ëŸ¬ ë³µêµ¬ ë¡œì§ ì¶”ê°€

---

## ðŸ“ ê²°ë¡ 

í˜„ìž¬ CodeB ì‹œìŠ¤í…œì€ ê¸°ë³¸ì ì¸ ì»¨í…Œì´ë„ˆ ê´€ë¦¬ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, 
í”„ë¡œë•ì…˜ ë ˆë²¨ì˜ ì•ˆì •ì„±ê³¼ ì‚¬ìš©ì„±ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.

**í•µì‹¬ ë¬¸ì œ**:
1. ë¶ˆì™„ì „í•œ ë°°í¬ ìžë™í™”
2. ê³¼ë„í•œ ë³´ì•ˆ ì„¤ì •
3. ì—ëŸ¬ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ ë¶€ìž¬

**ê¶Œìž¥ì‚¬í•­**:
1. ì¦‰ì‹œ: ìˆ˜ë™ìœ¼ë¡œ celly-creative í”„ë¡œì íŠ¸ ë³µêµ¬
2. ë‹¨ê¸°: API ì„œë²„ì™€ CLI ë„êµ¬ ê°œì„ 
3. ìž¥ê¸°: ì „ì²´ ì‹œìŠ¤í…œ ìž¬ì„¤ê³„ ê³ ë ¤

---

## ðŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° ì •ë¦¬ í•„ìš”

### í˜„ìž¬ íŒŒì¼ë“¤
```
/Users/admin/new_project/codeb-server/
â”œâ”€â”€ codeb-api-server.js       # API ì„œë²„ (ê°œì„  í•„ìš”)
â”œâ”€â”€ codeb-cli-v2.sh           # CLI ë„êµ¬ (ê¸°ëŠ¥ ì¶”ê°€ í•„ìš”)  
â”œâ”€â”€ env-templates.json        # í™˜ê²½ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ fix-celly-creative.sh     # ìž„ì‹œ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ update-commands.txt       # ì—…ë°ì´íŠ¸ ëª…ë ¹ì–´
â””â”€â”€ PROBLEM_ANALYSIS_REPORT.md # ì´ ë¬¸ì„œ
```

### ì„œë²„ ìƒíƒœ
- API ì„œë²„: 141.164.60.51:3008 (ì‹¤í–‰ ì¤‘)
- Caddy: 443 (HTTPS í”„ë¡ì‹œ)
- PostgreSQL: ê° í”„ë¡œì íŠ¸ë³„ ì»¨í…Œì´ë„ˆ
- Redis: ê° í”„ë¡œì íŠ¸ë³„ ì»¨í…Œì´ë„ˆ

### ê°œì„ ëœ êµ¬ì¡° ì œì•ˆ
```
codeb-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/           # API ì„œë²„ ì½”ë“œ
â”‚   â”œâ”€â”€ cli/           # CLI ë„êµ¬
â”‚   â””â”€â”€ templates/     # í”„ë¡œì íŠ¸ í…œí”Œë¦¿
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ environments/  # í™˜ê²½ë³„ ì„¤ì •
â”‚   â””â”€â”€ templates/     # í™˜ê²½ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ install.sh     # ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ deploy.sh      # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ migrate.sh     # ë§ˆì´ê·¸ë ˆì´ì…˜
â””â”€â”€ docs/
    â”œâ”€â”€ API.md         # API ë¬¸ì„œ
    â”œâ”€â”€ CLI.md         # CLI ì‚¬ìš©ë²•
    â””â”€â”€ TROUBLESHOOTING.md
```